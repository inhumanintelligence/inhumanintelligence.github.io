<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Profile</title>

<style>
*{
  margin:0;
  padding:0;
  box-sizing:border-box;
}

body{
  height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  background:#000;
  color:#fff;
  font-family:system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
  overflow:hidden;
  opacity:0;
  animation:fadeIn 1.2s ease forwards;
}

@keyframes fadeIn{
  to{ opacity:1; }
}

.card{
  text-align:center;
  position:relative;
  padding:50px 70px;
}

/* Avatar */
.avatar-wrap{
  position:relative;
  width:130px;
  height:130px;
  margin:0 auto 22px;
}

.avatar-wrap img{
  width:100%;
  height:100%;
  border-radius:50%;
  display:block;
  position:relative;
  z-index:2;
}

/* Matte Pulse Ring */
.pulse-ring{
  position:absolute;
  inset:-6px;
  border-radius:50%;
  border:2px solid rgba(255,255,255,0.85);
  animation:pulse 3s ease-in-out infinite;
  transform-origin:center;
  will-change:transform,opacity;
}

@keyframes pulse{
  0%,100%{ transform:scale(1); opacity:.75; }
  50%{ transform:scale(1.03); opacity:1; }
}

/* Status Dot */
.status-dot{
  position:absolute;
  bottom:8px;
  right:8px;
  width:16px;
  height:16px;
  border-radius:50%;
  border:2px solid #000;
  z-index:3;
}

/* Text */
h1{
  font-size:24px;
  font-weight:600;
  margin-bottom:6px;
}

.handle{
  font-size:14px;
  opacity:.6;
}

.status-label{
  margin-top:10px;
  font-size:13px;
  opacity:.5;
  min-height:18px;
  transition:opacity .3s ease;
}

/* Spotify */
.spotify{
  margin-top:18px;
  font-size:13px;
  opacity:.7;
  display:none;
}

.progress{
  height:3px;
  background:rgba(255,255,255,.2);
  margin-top:6px;
  width:180px;
  margin-left:auto;
  margin-right:auto;
  position:relative;
  overflow:hidden;
}

.progress-bar{
  height:100%;
  width:0%;
  background:#fff;
  transition:width .2s linear;
}
</style>
</head>
<body>

<div class="card">

  <div class="avatar-wrap">
    <div class="pulse-ring" id="pulse"></div>
    <img id="avatar">
    <div class="status-dot" id="statusDot"></div>
  </div>

  <h1 id="displayName">Loading...</h1>
  <div class="handle" id="handle">@loading</div>
  <div class="status-label" id="statusText"></div>

  <div class="spotify" id="spotifyBox">
    <div id="songName"></div>
    <div id="artistName" style="opacity:.6"></div>
    <div class="progress">
      <div class="progress-bar" id="progressBar"></div>
    </div>
  </div>

</div>

<script>
const USER_ID = "1439946318083784866";

/* Elements */
const avatarEl = document.getElementById("avatar");
const displayEl = document.getElementById("displayName");
const handleEl = document.getElementById("handle");
const statusDot = document.getElementById("statusDot");
const statusText = document.getElementById("statusText");
const pulseRing = document.getElementById("pulse");
const spotifyBox = document.getElementById("spotifyBox");
const songName = document.getElementById("songName");
const artistName = document.getElementById("artistName");
const progressBar = document.getElementById("progressBar");

/* Status Colors */
const STATUS_COLORS = {
  online:"#23A559",
  idle:"#F0B232",
  dnd:"#F23F43",
  offline:"#80848E"
};

/* Lanyard WebSocket */
const socket = new WebSocket("wss://api.lanyard.rest/socket");

socket.addEventListener("open",()=>{
  socket.send(JSON.stringify({
    op:2,
    d:{
      subscribe_to_id:USER_ID
    }
  }));
});

socket.addEventListener("message",(event)=>{
  const data = JSON.parse(event.data);

  if(data.t==="INIT_STATE" || data.t==="PRESENCE_UPDATE"){
    applyData(data.d);
  }
});

function applyData(data){
  const user = data.discord_user;
  if(!user) return;

  /* Display Name */
  const displayName = user.global_name || user.username;

  let handle;
  if(user.discriminator && user.discriminator !== "0"){
    handle = `${user.username}#${user.discriminator}`;
  }else{
    handle = user.username;
  }

  displayEl.textContent = displayName;
  handleEl.textContent = "@" + handle;

  avatarEl.src =
    `https://cdn.discordapp.com/avatars/${USER_ID}/${user.avatar}.png?size=256`;

  /* Status */
  const status = data.discord_status || "offline";
  statusDot.style.background = STATUS_COLORS[status] || "#80848E";
  statusText.textContent = status;

  /* Pulse only if not offline */
  pulseRing.style.display = status === "offline" ? "none" : "block";

  /* Custom Status */
  const custom = (data.activities || []).find(a=>a.type===4);
  if(custom && custom.state){
    statusText.textContent = custom.state;
  }

  /* Spotify */
  if(data.spotify){
    spotifyBox.style.display="block";
    songName.textContent = data.spotify.song;
    artistName.textContent = data.spotify.artist;

    const start = data.spotify.timestamps.start;
    const end = data.spotify.timestamps.end;

    updateProgress(start,end);
  }else{
    spotifyBox.style.display="none";
  }
}

function updateProgress(start,end){
  function animate(){
    const now = Date.now();
    const percent = ((now-start)/(end-start))*100;
    progressBar.style.width = Math.min(percent,100)+"%";
    if(percent<100) requestAnimationFrame(animate);
  }
  animate();
}
</script>

</body>
</html>
